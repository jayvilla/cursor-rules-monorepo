---
description: Standards for running dev servers, tests, and custom scripts using pnpm and Nx.
globs: ["package.json", "project.json", "nx.json", "scripts/**/*"]
---
# Workspace Execution & Scripting Standards

## 1. Development Commands
- **Primary Tool:** Always use `pnpm nx`. Never suggest `npm run` or `npx`.
- **Dev Servers:** 
  - Frontend: `pnpm nx serve web-app`
  - Backend: `pnpm nx serve api`
  - Multiple: `pnpm nx run-many -t serve -p web-app api`
- **Strict pnpm:** Use `pnpm install` for dependencies; use `pnpm exec` for one-off binary executions.

## 2. Testing Standards
- **Unit Testing:** Use `pnpm nx test <project>`. 
- **Watch Mode:** Use `pnpm nx test <project> --watch`.
- **Affected Tests:** For PRs, prioritize `pnpm nx affected -t test` to only run tests for changed code.
- **Coverage:** Use `pnpm nx test <project> --code-coverage`. Reports must be output to `coverage/apps/<project>`.

## 3. Custom Scripting
- **Location:** Place project-wide automation scripts in the root `/scripts` directory using TypeScript (`.ts`).
- **Execution:** Run custom scripts via `pnpm ts-node scripts/<name>.ts`.
- **Project Specifics:** Use `project.json` targets for project-specific scripts rather than cluttering the root `package.json`.

## 4. Database Scripts (TypeORM/Postgres)
- **Migrations:**
  - Generate: `pnpm nx run api:typeorm-migration-generate --name=<name>`
  - Apply: `pnpm nx run api:typeorm-migration-run`
  - Revert: `pnpm nx run api:typeorm-migration-revert`
- **Seeding:** Use `pnpm nx run api:seed` if a seeding target is defined.

## 5. CI/CD Context
- **Validation:** Always suggest running `pnpm nx format:check` and `pnpm nx lint` before committing.
- **Build:** Use `pnpm nx build <project> --prod`.
